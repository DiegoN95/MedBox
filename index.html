<!DOCTYPE html>
<html>
  <head>
    <title>MedBox OS</title>
      
    <!-- Resources start --> 
    <link href="https://fonts.googleapis.com/css?family=Karla:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">
    <!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	
	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<link rel="stylesheet" href="css/style.css">
    <!-- Resources end --> 
      
    <!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  </head>
  <body>
      
      <div id="fh5co-page">
		<header>
			<div class="container">
				<div class="fh5co-navbar-brand">
					<h1 class="text-left"><a class="fh5co-logo" href="index.html">Med Box</a></h1>
					<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
				</div>
			</div>
		</header>
		<div id="fh5co-intro-section">
			<div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 animate-box text-center">
						<h2 class="intro-heading">Treatment modification platform</h2>
						<p><span>The IoT at the service of your health</span></p>
					</div>
				</div>
			</div>
		</div>
        <section id="treatment_section" class="parallax" style="background-image: url('images/landscape.jpg');">  
            <div id="actual" class="upper-section">
            <div class="container">
                <div class="row-md-3 row-sm-6">
                  <div class="col-md-3 col-sm-6 justify-content-center">
                      <div class="actual-title">
                        <h1>Actual treatment:</h1>    
                      </div>
                  </div>
                  <div class="col-md-9 col-sm-6 ">
                    <div class="row">
                        <div class="text-center clearfix">
                            <nav class="medicament-filter">
                                <ul class="filter_bar">
                                    <li><a class="btn btn-primary" href="#" data-filter="*">All</a></li>
                                    <li><a class="btn btn-primary" href="#" data-filter=".type1">Type1</a></li>
                                    <li><a class="btn btn-primary" href="#" data-filter=".type2">Type2</a></li>
                                    <li><a class="btn btn-primary" href="#" data-filter=".type3">Type3</a></li>
                                </ul>
                            </nav>
                        </div>  
                    </div>
                    <div class="row-md-9 row-sm-6 justify-content-center">
                        <div id="edit_window" class="edition_interface">
                            <div class="row ">
                                <div class="col-md-6">  
                                <h1>Edit treatment</h1>
                                <form id="editInfo">
                                    <h3>Med name:<br>
                                        <input type="text" name="MedName" id="MedName" value="Insert medicament name"><br>Take period:<br>
                                        <input type="text" name="TakePeriod" id="TakePeriod" value="Insert Period">
                                        <br>Ocurrence:<br>
                                        <input type="text" name="Ocurrence" id="Ocurrence" value="Insert ocurrence">
                                        <br>Quantity:<br>
                                        <input type="text" name="Quantity" id="Quantity" value="Insert Quantity"><br>
                                    </h3>
                                    </form>
                            </div> 
                            <div class="col-lg-6 ">
                                <img id="imgMed" src="images/Add.png">
                            </div>
                            </div>
                                <button class="btn edit_btn"  href="#" onclick="save_treatment()">Save</button>
                                <button class="btn edit_btn"  href="#" onclick="toogle_edit()">Cancel</button>
                        </div><!-- end edit_window -->
                        <div id="pannel" class="masonry_wrapper" data-scroll-reveal="enter from the bottom after 0.5s">
                            <!-- treatement items place -->   
                            <div class="col-md-6 col-lg-4 item entry item-h2 type1 print">
                                <img src="images/Add.png">
                                <button id="detail" class="hovereffect" onclick="toogle_edit()">
                                    <!-- space to populate with json data -->
                                    Add element<br>+
                                </button><!-- end hovereffect -->
                            </div> 
				        </div>  
                    </div>
                  </div>
                </div>
            </div>
        </div>
        </section>    
        <footer>
			<div id="footer">
				<div class="container">
					<div class="row justify-content-center">
						<div class="col-md-4 text-center">
							<h3 class="section-title">NovaTech</h3>
							<p>StartUp destinated to implement the MedBox &reg;  proyect in order to ease the pain of the elders.</p>
						</div>
						<div class="col-md-4 text-center">
							<h3 class="section-title">Our Services</h3>
							<ul>
								<li><a href="#">FAQ</a></li>
							</ul>
						</div>
						<div class="col-md-4 text-center">
							<h3 class="section-title">Information</h3>
							<ul>
								<li><a href="#">Terms &amp; Condition</a></li>
								<li><a href="#">License</a></li>
								<li><a href="#">Privacy &amp; Policy</a></li>
							</ul>
						</div>
					</div>
					<div class="row copy-right">
						<div class="col-md-6 col-md-offset-3 text-center">
							<h3 class="section-title">Contact Us</h3>
							<p class="fh5co-social-icon">
								<a href="#"><i class="icon-twitter2"></i></a>
								<a href="#"><i class="icon-facebook2"></i></a>
								<a href="#"><i class="icon-instagram"></i></a>
								<a href="#"><i class="icon-dribbble2"></i></a>
								<a href="#"><i class="icon-youtube"></i></a>
							</p>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Counters -->
	<script src="js/jquery.countTo.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Main JS -->
	<script src="js/main.js"></script>
    <!-- JSON script -->
    <script>
        let requestURL = 'Data/100001.json';
        let request = new XMLHttpRequest();
        request.open('GET', requestURL);
        request.responseType = 'json';
        request.send();
        
        const pan = document.querySelector('#pannel.masonry_wrapper');

        request.onload = function() {
        const traitement = request.response;
        showTraitement(traitement);
        $("#edit_window.edition_interface").slideUp("slow");
        }
        
        function showTraitement(jsonObj) {
            const rX = jsonObj['Traitement'];
            
            for (var j = 0; j < rX.length; j++){
                var temp_id = j+"Med";
                const myimg = document.createElement('img'); 
                myimg.setAttribute("src", "images/" + rX[j]["Nom du médicament"] + ".png");
                const myhover = document.createElement('button');
                myhover.className = 'hovereffect';  
                myhover.id = "B"+temp_id;
                myhover.addEventListener("click", load_treatment);
                const mytest = document.createElement('div');
                mytest.className = 'col-md-6 col-lg-4 item entry item-h2 type1 print';
                mytest.id = temp_id;
                const myData = rX[j];
                window.gtreatment = rX;
                
                const myArticle = document.createElement('article');
                const myH2 = document.createElement('h2');
                const mytile1 = document.createElement('p');
                const myPara1 = document.createElement('p');
                const mytile2 = document.createElement('p');
                const myPara2 = document.createElement('p');
                const mytile3 = document.createElement('p');
                const myPara3 = document.createElement('p');

                myH2.textContent = 'Med name: ' + rX[j]["Nom du médicament"];
                mytile1.textContent = 'Take period: ';
                myPara1.textContent = rX[j]["Période de prise"];
                mytile2.textContent = 'Ocurrence per day: ';
                myPara2.textContent = rX[j]["Nonbre de prise par Jour"];
                mytile3.textContent = 'Quantity: ';
                myPara3.textContent = rX[j]["Quantité par prise"] + " per day.";

                myArticle.appendChild(myH2);
                myArticle.appendChild(mytile1);
                myArticle.appendChild(myPara1);
                myArticle.appendChild(mytile2);
                myArticle.appendChild(myPara2);
                myArticle.appendChild(mytile3);
                myArticle.appendChild(myPara3);

                myhover.appendChild(myArticle);
                mytest.appendChild(myimg);
                mytest.appendChild(myhover);
                $("#"+temp_id).data(myData);
                pan.appendChild(mytest);
            }
        }
        
        var selected_treatment = NaN;
        
        function toogle_edit() {
            var x = document.querySelector("#edit_window.edition_interface");
            if (x.style.display == "none") {
                 $("#edit_window.edition_interface").slideToggle("slow");
                $("#pannel.masonry_wrapper").slideToggle("slow");
            } else {
                $("#edit_window.edition_interface").slideToggle("slow");
                $("#pannel.masonry_wrapper").slideToggle("slow",function(){
                    document.getElementById("imgMed").setAttribute("src","images/Add.png");
                    document.getElementById("MedName").setAttribute("value","Insert medicament name");
                    document.getElementById("TakePeriod").setAttribute("value","Insert Period");
                    document.getElementById("Ocurrence").setAttribute("value","Insert ocurrence");
                    document.getElementById("Quantity").setAttribute("value","Insert Quantity");
                  });
            }
        }
        
        function load_treatment() {
            var sCaller = this.parentElement;
            var ntret = parseInt(sCaller.id);
            selected_treatment = ntret;
            const MyForm = document.getElementById("editInfo");
            const Myname = document.getElementById("MedName");
            const Myper = document.getElementById("TakePeriod");
            const Myocu = document.getElementById("Ocurrence");
            const Myqty = document.getElementById("Quantity");
            const MyIMed = document.getElementById("imgMed");
            MyForm.reset();
            Myname.setAttribute("value", gtreatment[ntret]["Nom du médicament"]);
            Myper.setAttribute("value", gtreatment[ntret]["Période de prise"]);
            Myocu.setAttribute("value", gtreatment[ntret]["Nonbre de prise par Jour"]);
            Myqty.setAttribute("value", gtreatment[ntret]["Quantité par prise"]);
            MyIMed.setAttribute("src", "images/" + gtreatment[ntret]["Nom du médicament"] + ".png");
            toogle_edit();
        }
        
        function save_treatment() {
            const MyForm = document.getElementById("editInfo");
            const Myname = document.getElementById("MedName");
            const Myper = document.getElementById("TakePeriod");
            const Myocu = document.getElementById("Ocurrence");
            const Myqty = document.getElementById("Quantity");
            const MyIMed = document.getElementById("imgMed");
            const data_to_save = gtreatment[selected_treatment];
            gtreatment[selected_treatment]["Nom du médicament"] = Myname.value; 
            gtreatment[selected_treatment]["Période de prise"] = Myper.value; 
            gtreatment[selected_treatment]["Nonbre de prise par Jour"] = Myocu.value; 
            gtreatment[selected_treatment]["Quantité par prise"] = Myqty.value; 
            toogle_edit();
            
            var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
            var theUrl = 'https://raw.githubusercontent.com/DiegoN95/MedBox/master/Data/100001.json';
            xmlhttp.open('POST', requestURL);
            xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            var obj = { Traitement: gtreatment };
            xmlhttp.send(JSON.stringify(obj));
        }
        
        function download(content, fileName, contentType) {
            var a = document.createElement("a");
            var file = new Blob([content], {type: contentType});
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            a.click();
        }
    </script>
    
  </body>
</html>
